# Local server configuration
# This file is loaded by the IRCd and contains instance-specific settings

# SSL port for clients
Port {
     port = 8443;
     ssl = yes;
};

# Server port for X3 services connection (SSL/TLS)
Port {
     port = 4496;
     server = yes;
     ssl = yes;
};

# Connect block for X3 Services
Connect {
     name = "x3.services";
     host = "172.29.0.3";
     password = "abcdefg";
     port = 4496;
     class = "Server";
     hub;
     autoconnect = yes;
};

# Connect block for leaf server (nefarious2)
Connect {
     name = "leaf.fractalrealities.net";
     host = "172.29.0.5";
     password = "serverlink123";
     port = 4496;
     class = "LeafServer";
};

# Connect block for hub2 server (nefarious3) - multi profile
Connect {
     name = "hub2.fractalrealities.net";
     host = "172.29.0.6";
     password = "serverlink123";
     port = 4496;
     class = "Server";
     hub;
};

# Operator block
Operator {
     name = "oper";
     host = "*@*";
     password = "$PLAIN$shmoo";
     class = "Opers";
     local = no;
};

# ---- linesync stuff

Forwards {
        "." = "x3.services";
};

Pseudo "AUTH" {
	name = "authserv";
	nick = "AuthServ@x3.services";
	prepend = "AUTH ";
};

Pseudo "AUTHSERV" {
        name = "authserv";
        nick = "AuthServ@x3.services";
};

Pseudo "AS" {
        name = "authserv";
        nick = "AuthServ@x3.services";
};
Pseudo "NET" {
        name = "NET";
        nick = "net@x3.services";
};
Pseudo "GLOBAL" {
        name = "NET";
        nick = "net@x3.services";
};
Pseudo "MEMOSERV" {
        name = "MemoServ";
        nick = "memoserv@x3.services";
};
Pseudo "MEMO" {
        name = "MemoServ";
        nick = "memoserv@x3.services";
};
Pseudo "SEND" {
        name = "MemoServ";
        nick = "memoserv@x3.services";
        prepend = "SEND ";
};
Pseudo "READ" {
        name = "MemoServ";
        nick = "memoserv@x3.services";
        prepend = "READ ";
};
Pseudo "O3" {
        name = "O3";
        nick = "O3@x3.services";
};
Pseudo "OS" {
        name = "O3";
        nick = "O3@x3.services";
};
Pseudo "OPERSERV" {
        name = "O3";
        nick = "O3@x3.services";
};

Pseudo "REGISTER" {
        name = "AuthServ";
        nick = "AuthServ@x3.services";
        prepend = "REGISTER ";
};
Pseudo "X3" {
        name = "X3";
	nick = "X3@x3.services";
};

#######################
## Sync'd Nick Jupes ##
#######################
Jupe {
     nick = "X3,OperServ,NickServ,AuthServ,HelpServ,SpamServ,Global";
     nick = "O,O3,IRCop,Oper,net,_net,help";
     nick = "OperDev,srvx,REGISTER,PASS,NEWPASS";
     nick = "GameServ";
     nick = "COM1,COM2,COM3,COM4,LPT1,LPT2,AUX,CON";
     nick = "Security,NET,ANET,Status,LOGIN,AUTH,Admin,Administrator";
     nick = "X2,X,W";
     nick = "X2dev,X3dev";
     nick = "O2,O2dev";
     nick = "pxys,prox,ProxyServ,ProxyCheck";
     nick = "OpServ";
     nick = "ChanServ,ChanServer,ChannelServ,ChannelServer,ChanS3rv";
     nick = "Services,Server,service";
     nick = "X0,X1,X2,X3,X4,X5";
     nick = "X6,X7,X8,X9,X10";
     nick = "C,C3,D3";
};

############################
## Sync'd Uworld services ##
############################
UWorld {
     name = "x3.services";
     name = "OperServ.Services";
     name = "OperDev.Services";
     name = "GameServ.Services";
     name = "Security.Services";
     name = "Security-Dev.Services";
     name = "X2.Services";
     name = "X2dev.Services";
     name = "O2.Services";
     name = "ProxyCheck.Services";
     name = "OpServ.Services";
     name = "ChanServ.Services";
     name = "NET.Services";
     name = "jupes1";
     name = "jupes2";
     name = "chanfix.Services";
};

IAuth {
  program = "node" "/home/nefarious/ircd/iauthd-ts/index.js" "-v" "-c" "/home/nefarious/ircd/ircd.conf";
};

features {

 "LOG" = "SYSTEM" "FILE" "ircd.log";
 "LOG" = "SYSTEM" "LEVEL" "CRIT";

  "DOMAINNAME"="network";
  "RELIABLE_CLOCK"="TRUE";
#  "BUFFERPOOL"="27000000";
#  "HAS_FERGUSON_FLUSHER"="FALSE";
#  "CLIENT_FLOOD"="1024";
  "SERVER_PORT"="4789";
  "NODEFAULTMOTD"="TRUE";
  "MOTD_BANNER"="See our website for information about this network.";
#  "KILL_IPMISMATCH"="FALSE";
#  "IDLE_FROM_MSG"="TRUE";
  "HUB"="TRUE";
#  "WALLOPS_OPER_ONLY"="FALSE";
#  "NODNS"="FALSE";
  "RANDOM_SEED"="moo";
#  "DEFAULT_LIST_PARAM"="A<20"; #Waiting for A to be added to nef2 (like nef1 M) for active channels
  "DEFAULT_LIST_PARAM"=">4";

#  "NICKNAMEHISTORYLENGTH"="800";
  "NETWORK"="Network";
  "HOST_HIDING"="TRUE";
  "HIDDEN_HOST"="Users.Network";
#  "HIDDEN_IP"="127.0.0.1";
#  "KILLCHASETIMELIMIT"="30";
  "MAXCHANNELSPERUSER"="50";
  "NICKLEN" = "30";
#  "AVBANLEN"="40";
#  "MAXBANS"="50";
  "MAXSILES"="25";
#  "HANGONGOODLINK"="300";
#  "HANGONRETRYDELAY" = "10";
#  "CONNECTTIMEOUT" = "90";
#  "MAXIMUM_LINKS" = "1";
#  "PINGFREQUENCY" = "120";
#  "CONNECTFREQUENCY" = "600";
#  "DEFAULTMAXSENDQLENGTH" = "40000";
#  "GLINEMAXUSERCOUNT" = "20";
#  "MPATH" = "ircd.motd";
#  "RPATH" = "remote.motd";
#  "PPATH" = "ircd.pid";
#  "TOS_SERVER" = "0x08";
#  "TOS_CLIENT" = "0x08";
#  "POLLS_PER_LOOP" = "200";
#  "IRCD_RES_TIMEOUT" = "4";
#  "IRCD_RES_RETRIES" = "2";
  "AUTH_TIMEOUT" = "8";

  # Native DNSBL settings (commented out - not supported in current build)
  # "NATIVE_DNSBL" = "TRUE";
  # "DNSBL_TIMEOUT" = "5";
  # "DNSBL_CACHETIME" = "21600";
  # "DNSBL_BLOCKMSG" = "Sorry! Your connection has been rejected because of your internet address's poor reputation. You may try an authenticated login using Login-On-Connect (LOC) instead.";
  # Increased for testing - allows many connections from same IP
  # CLONE_LIMIT = max connections within CLONE_PERIOD seconds
  # Setting high limit and long period to allow test suite to run
  "IPCHECK_CLONE_LIMIT" = "1000";
  "IPCHECK_CLONE_PERIOD" = "600";
  "IPCHECK_CLONE_DELAY" = "0";
#  "CHANNELLEN" = "200";
#  "CONFIG_OPERCMDS" = "TRUE";
#  "OPLEVELS" = "TRUE";
#  "ZANNELS" = "TRUE";
  "LOCAL_CHANNELS" = "FALSE";
  "ANNOUNCE_INVITES" = "TRUE";
#  These were introduced by Undernet CFV-165 to add "Head-In-Sand" (HIS)
#  behavior to hide most network topology from users.
#  "HIS_SNOTICES" = "TRUE";
#  "HIS_SNOTICES_OPER_ONLY" = "TRUE";
#  "HIS_DEBUG_OPER_ONLY" = "TRUE";
#  "HIS_WALLOPS" = "TRUE";
#  "HIS_MAP" = "TRUE";
#  "HIS_LINKS" = "TRUE";
#  "HIS_TRACE" = "TRUE";
#  "HIS_STATS_a" = "TRUE";
#  "HIS_STATS_c" = "TRUE";
#  "HIS_STATS_d" = "TRUE";
#  "HIS_STATS_e" = "TRUE";
#  "HIS_STATS_f" = "TRUE";
#  "HIS_STATS_g" = "TRUE";
#  "HIS_STATS_i" = "TRUE";
#  "HIS_STATS_j" = "TRUE";
#  "HIS_STATS_J" = "TRUE";
#  "HIS_STATS_k" = "TRUE";
#  "HIS_STATS_l" = "TRUE";
#  "HIS_STATS_L" = "TRUE";
#  "HIS_STATS_m" = "TRUE";
#  "HIS_STATS_M" = "TRUE";
#  "HIS_STATS_o" = "TRUE";
#  "HIS_STATS_p" = "TRUE";
#  "HIS_STATS_q" = "TRUE";
#  "HIS_STATS_r" = "TRUE";
#  "HIS_STATS_R" = "TRUE";
#  "HIS_STATS_S" = "TRUE";
#  "HIS_STATS_t" = "TRUE";
#  "HIS_STATS_T" = "TRUE";
#  "HIS_STATS_u" = "FALSE";
#  "HIS_STATS_U" = "TRUE";
#  "HIS_STATS_v" = "TRUE";
#  "HIS_STATS_w" = "TRUE";
#  "HIS_STATS_x" = "TRUE";
#  "HIS_STATS_y" = "TRUE";
#  "HIS_STATS_z" = "TRUE";
#  "HIS_STATS_IAUTH" = "TRUE";
#  "HIS_WHOIS_SERVERNAME" = "TRUE";
  "HIS_WHOIS_IDLETIME" = "FALSE";
#  "HIS_WHOIS_LOCALCHAN" = "TRUE";
#  "HIS_WHO_SERVERNAME" = "TRUE";
#  "HIS_WHO_HOPCOUNT" = "TRUE";
#  "HIS_MODEWHO" = "TRUE";
#  "HIS_BANWHO" = "TRUE";
#  "HIS_KILLWHO" = "TRUE";
#  "HIS_REWRITE" = "TRUE";
#  "HIS_REMOTE" = "TRUE";
#  "HIS_NETSPLIT" = "TRUE";
  "HIS_SERVERNAME" = "*.network";
  "HIS_SERVERINFO" = "IRC Network";
  "HIS_URLSERVERS" = "Help URL";
  "URLREG" = "Help URL";
#  "CHECK" = "TRUE";
#  "CHECK_EXTENDED" = "TRUE";
#  "MAX_CHECK_OUTPUT" = "1000";
  "OPER_WHOIS_PARANOIA" = "FALSE";
  "OPER_HIDE" = "FALSE";
  "AUTOCHANMODES" = "TRUE";
  "AUTOCHANMODES_LIST" = "nt";
#  "UHNAMES" = "TRUE";
#  "RESTARTPASS" = "";
#  "DIEPASS" = "";
#  "HIS_STATS_W" = "TRUE";
  "WHOIS_OPER" = "is an Operator";
  "WHOIS_SERVICE" = "is a Network Service Bot";
  "TARGET_LIMITING" = "FALSE";
#  "OPER_XTRAOP" = "FALSE";
#  "OPERMOTD" = "FALSE";
#  "RULES" = "FALSE";
#  "DISABLE_SHUNS" = FALSE";
#  "SHUNMAXUSERCOUNT" = "20";
#  "HIS_SHUN_REASON" = "TRUE";
#  "HIS_GLINE_REASON" = "FALSE";
  "NOIDENT" = "TRUE";
#  "EXTENDED_ACCOUNTS" = "TRUE";
  "LOGIN_ON_CONNECT" = "TRUE";
  "LOC_SENDHOST" = "TRUE";
  "LOC_SENDSSLFP" = "TRUE";
  "LOC_DEFAULT_SERVICE" = "AuthServ";
  "LOC_TIMEOUT" = "3";
#  "STRICTUSERNAME" = "FALSE";
#  "APASS_CANSEND" = "FALSE";
#  "HOST_IN_TOPIC" = "TRUE";
#  "HIS_STATS_s" = "TRUE";
#  "SETHOST" = "TRUE";
#  "FLEXIBLEKEYS" = "FALSE";
#  "HIS_STATS_E" = "TRUE";
  "SASL_SERVER" = "x3.services";
  # Reduced from 60 for testing - opers bypass this anyway
  "LISTDELAY" = "2";
#  "ALLOW_OPLEVEL_CHANGE" = "FALSE";
#  "NETWORK_REHASH" = "TRUE";
#  "LIST_SHOWMODES_OPERONLY" = "FALSE";
  "LIST_PRIVATE_CHANNELS" = "(private)";
#  "MAXWATCHS" = "128";
#  "HIS_STATS_Z" = "TRUE";
  "SASL_TIMEOUT" = "30";
  "NOMULTITARGETS" = "TRUE";
  "CHMODE_T" = "FALSE";
  "CHMODE_a" = "FALSE";
#  "CHMODE_c" = "TRUE";
#  "CHMODE_C" = "TRUE";
  "CHMODE_L" = "TRUE";
#  "CHMODE_M" = "TRUE";
#  "CHMODE_N" = "TRUE";
#  "CHMODE_O" = "TRUE";
#  "CHMODE_Q" = "TRUE";
#  "CHMODE_S" = "TRUE";
#  "CHMODE_Z" = "TRUE";
  "HALFOPS" = "TRUE";
  "EXCEPTS" = "TRUE";
#  "MAXEXCEPTS" = 45;
#  "AVEXCEPTLEN" = 40;
#  "CHMODE_e_CHMODEEXCEPTION" = "FALSE";
#  "HALFOP_DEFHALFOP_SELF" = "TRUE";
#  "CHMODE_Z_STRICT" = "TRUE";
#  "MAX_BOUNCE" = "5";
  "EXTBANS" = "TRUE";
  "EXTBAN_j_MAXDEPTH" = "1";
  "EXTBAN_j_MAXPERCHAN" = "2";
  "EXTBAN_a" = "TRUE";
  "EXTBAN_c" = "TRUE";
  "EXTBAN_j" = "TRUE";
#  "EXTBAN_n" = "TRUE";
  "EXTBAN_q" = "TRUE";
  "EXTBAN_r" = "TRUE";
  "EXTBAN_m" = "TRUE";
  "EXTBAN_M" = "TRUE";
#  "OMPATH" = "ircd.opermotd";
#  "EPATH" = "ircd.rules";
#  "HIDDEN_HOST_QUIT" = "TRUE";
#  "HIDDEN_HOST_SET_MESSAGE" = "Registered";
#  "HIDDEN_HOST_UNSET_MESSAGE" = "UnRegistered";
#  "ALLOWRMX" = "FALSE";
  "OPERHOST_HIDING" = "FALSE";
#  "HIDDEN_OPERHOST" = "Staff.Nefarious";
  "HOST_HIDING_STYLE" = "3";
  "HOST_HIDING_PREFIX" = "AN";
  "HOST_HIDING_KEY1" = "8oe8u6aoeurh4y8haoua8o.dh8,3h";
  "HOST_HIDING_KEY2" = "ttttaoeuaoeutbjbjb37462tce8ge.hgp.tc";
  "HOST_HIDING_KEY3" = "pleasent puppies pee perously prefixing pools";
  "HOST_HIDING_COMPONENTS" = "1";
  "CTCP_VERSIONING" = "TRUE";
  "CTCP_VERSIONING_KILL" = "TRUE";
  "CTCP_VERSIONING_CHAN" = "TRUE";
  "CTCP_VERSIONING_CHANNAME" = "#mrsnoopy";
  "CTCP_VERSIONING_USEMSG" = "TRUE";
  "CTCP_VERSIONING_NOTICE" = "*** Checking your client version (sorry..)";
#  "GEOIP_ENABLE" = "FALSE";
#  "GEOIP_FILE" = "GeoIP.dat";
#  "GEOIP_IPV6_FILE" = "GeoIPv6.dat";
#  "SSL_CERTFILE" = "fullchain.pem";
#  "SSL_KEYFILE" = "privkey.pem";
   # SSL cert in persistent volume (generated by init container, can be updated by gitsync)
   "SSL_CERTFILE" = "ssl/ircd.pem";
   "SSL_KEYFILE" = "ssl/ircd.pem";
#  "SSL_CACERTFILE" = "";
#  "SSL_VERIFYCERT" = "FALSE";
#  "SSL_NOSELFSIGNED" = "FALSE";
#  "SSL_REQUIRECLIENTCERT" = "FALSE";
#  "DISABLE_ZLINES" = "FALSE";
#  "HIS_ZLINE_REASON" = "FALSE";
#  "ZLINEMAXUSERCOUNT" = "20";
#  "CAP_multi_prefix" = "TRUE";
#  "CAP_userhost_in_names" = "TRUE";
#  "CAP_extended_join" = "TRUE";
#  "CAP_away_notify" = "TRUE";
#  "CAP_account_notify" = "TRUE";
#  "CAP_sasl" = "TRUE";
   "CAP_tls" = "FALSE";  #Offer STARTTLS on non-ssl ports - With this enabled, kvirc was failing intermittantly to
                         #connect. It is a terrible idea cryptographically anyway. Turns off CAPABILITY
                         #for using it.
   "URL_CLIENTS" = "http://network/";

   # Enable draft IRCv3 capabilities (disabled by default)
   "CAP_draft_chathistory" = "TRUE";
   "CAP_draft_event_playback" = "TRUE";
   "CAP_draft_message_redaction" = "TRUE";
   "CAP_draft_account_registration" = "TRUE";
   "CAP_draft_read_marker" = "TRUE";
   "CAP_draft_channel_rename" = "TRUE";
   "CAP_draft_metadata_2" = "TRUE";
   "CAP_draft_webpush" = "TRUE";

   # WebSocket support (RFC 6455)
   "DRAFT_WEBSOCKET" = "TRUE";

   # PM Chathistory consent settings
   # Enable private message history storage
   "CHATHISTORY_PRIVATE" = "TRUE";

   # GitSync - centralized config distribution via git (commented out - not supported in current build)
   # "GITSYNC_ENABLE" = "TRUE";
   # "GITSYNC_INTERVAL" = "300";
   # "GITSYNC_REPOSITORY" = "git@github.com:MrLenin/gitsync-test.git";
   # "GITSYNC_BRANCH" = "main";
   # "GITSYNC_LOCAL_PATH" = "/tmp/gitsync";
   # "GITSYNC_CONF_FILE" = "gitsync/gitsync.conf";
   # # SSH key for git auth (auto-generated if not exists, stored in persistent gitsync volume)
   # "GITSYNC_SSH_KEY" = "gitsync/gitsync_key";
   # Consent mode: 0=global (opt-out), 1=single-party (either opts in), 2=multi-party (both must opt in)
   "CHATHISTORY_PRIVATE_CONSENT" = "2";
   # Advertise pm= in draft/chathistory capability value (non-standard extension)
   "CHATHISTORY_ADVERTISE_PM" = "FALSE";
   # Send policy notice on connect (NOTE for standard-replies, NOTICE for others)
   "CHATHISTORY_PM_NOTICE" = "TRUE";

   #Needed until every server is updated past  2.0-173-g437c538
   #"SSL_NOTLSV1" = "FALSE"; disabled 10/20/2015
   #"SSL_NOSSLV3" = "FALSE";

};

####
# Iauth config
# note: iauth does not consider '#IAUTH' commented. Add a 2nd # to comment them out
#       (this allows the config to piggyback on ircd.conf)
###
#IAuth {
#    program = "/usr/bin/perl" "iauthd.pl" "-v" "-d" "-c" "ircd.conf";
#};

IAuth {
    program = "node" "/home/nefarious/ircd/iauthd-ts/index.js" "-v" "-c" "/home/nefarious/ircd/ircd.conf";
};

# Enable SASL
#IAUTH POLICY SRTAWUwFr

#IAUTH CACHETIMEOUT 21600
#IAUTH DNSTIMEOUT 5
#IAUTH BLOCKMSG Sorry! Your connection has been rejected because of your internet address's poor reputation. You may try an authenticated login using Login-On-Connect (LOC) instead.
#IAUTH DNSBL server=dnsbl-2.uceprotect.net index=2 mark=uce-2

#Enable this to test the static users file iauthd-ts sasl support
#DISABLED# SASLDB /home/nefarious/ircd/saslusers

#Enable this to test the ldap iauthd-ts sasl support
#DISABLED# AUTH provider=ldap uri=ldap://server:389 mode=direct userdn=uid=%s,ou=users,dc=example,dc=com

# Keycloak REST iauthd-ts SASL support
# Realm "testnet" with client "irc-client" configured via scripts/setup-keycloak.sh
#IAUTH AUTH provider=keycloak url=http://keycloak:8080 realm=testnet clientid=irc-client

#IAUTH SASLFAILMSG TESTing SASL Auth Failed Message

############################
## Native DNSBL Configuration (COMMENTED OUT - not supported in current build)
############################
# NOTE: DNSBL blocks are not currently supported in this ircd version.
# They will need to be handled via iauthd or external mechanisms.

# # Afternet whitelist
# DNSBL {
#     name = "dnsbl.afternet.org";
#     host = "2";
#     action = whitelist;
#     reason = "whitelist";
# };
#
# # Afternet RBL
# DNSBL {
#     name = "dnsbl.afternet.org";
#     host = "250";
#     action = block_anon;
#     reason = "afternetrbl";
# };
#
# # Afternet Cloud
# DNSBL {
#     name = "dnsbl.afternet.org";
#     host = "251";
#     action = block_anon;
#     reason = "cloud";
# };
#
# # SORBS
# DNSBL {
#     name = "dnsbl.sorbs.net";
#     host = "2,3,4,5,6,7,9";
#     action = block_anon;
#     reason = "sorbs";
# };
#
# # DroneBL
# DNSBL {
#     name = "dnsbl.dronebl.org";
#     host = "2,3,5,6,7,8,9,10,13,14,15";
#     action = block_anon;
#     reason = "dronebl";
# };
#
# # EFnet RBL - Tor
# DNSBL {
#     name = "rbl.efnetrbl.org";
#     host = "4";
#     action = block_anon;
#     reason = "tor";
# };
#
# # EFnet RBL - General
# DNSBL {
#     name = "rbl.efnetrbl.org";
#     host = "1,2,3,5";
#     action = block_anon;
#     reason = "efnetrbl";
# };
#
# # UCEProtect Level 2 (mark only, no block)
# DNSBL {
#     name = "dnsbl-2.uceprotect.net";
#     host = "2";
#     action = mark;
#     reason = "uce-2";
# };
#
# # Tor Exit List - port 6667
# DNSBL {
#     name = "6667.122.134.230.173.ip-port.exitlist.torproject.org";
#     host = "2";
#     action = block_anon;
#     reason = "tor";
# };
#
# # Tor Exit List - port 80
# DNSBL {
#     name = "80.204.128.107.97.ip-port.exitlist.torproject.org";
#     host = "2";
#     action = block_anon;
#     reason = "tor";
# };
#
# # Tor Exit List - port 443
# DNSBL {
#     name = "443.204.128.107.97.ip-port.exitlist.torproject.org";
#     host = "2";
#     action = block_anon;
#     reason = "tor";
# };
#
# # CBL (Composite Blocking List) - mark only
# DNSBL {
#     name = "cbl.abuseat.org";
#     host = "2";
#     action = mark;
#     reason = "cbl";
# };
